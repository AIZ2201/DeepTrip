{% extends "layout.html" %}

{% block title %}ËµÑÊ∫êÈ¢ÑÂÆö - ÊóÖÊ∏∏Â∞èÂä©Êâã{% endblock %}

{% block css %}
<style>
    /* ËµÑÊ∫êÈ¢ÑÂÆöÈ°µÈù¢Ê†∑Âºè */
    .booking-container {
        margin-bottom: 40px;
    }
    
    .booking-tabs {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        border-bottom: 2px solid #eee;
    }
    
    .booking-tab {
        padding: 10px 20px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 500;
        color: #7f8c8d;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
    }
    
    .booking-tab.active {
        color: #3498db;
        border-bottom-color: #3498db;
    }
    
    .booking-content {
        display: none;
    }
    
    .booking-content.active {
        display: block;
    }
    
    /* Á≠õÈÄâÂô®Ê†∑Âºè */
    .filter-bar {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* ËµÑÊ∫êÂàóË°®Ê†∑Âºè */
    .resource-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 30px;
    }
    
    .resource-card {
        background-color: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .resource-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .resource-image {
        height: 200px;
        overflow: hidden;
    }
    
    .resource-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .resource-card:hover .resource-image img {
        transform: scale(1.05);
    }
    
    .resource-content {
        padding: 20px;
    }
    
    .resource-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 10px;
        color: #2c3e50;
    }
    
    .resource-location {
        display: flex;
        align-items: center;
        color: #7f8c8d;
        margin-bottom: 15px;
    }
    
    .resource-location i {
        margin-right: 5px;
    }
    
    .resource-rating {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .star-rating {
        color: #f39c12;
        margin-right: 10px;
    }
    
    .rating-score {
        font-weight: 600;
    }
    
    .resource-price {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }
    
    .price-value {
        font-size: 24px;
        font-weight: 700;
        color: #e74c3c;
    }
    
    .price-unit {
        font-size: 14px;
        color: #7f8c8d;
    }
    
    /* ÂàÜÈ°µÊ†∑ÂºèÂ¢ûÂº∫ */
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 40px;
    }
    
    /* È¢ÑÂÆöÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
    .booking-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1001;
    }
    
    .booking-modal.active {
        display: flex;
    }
    
    .modal-dialog {
        background-color: white;
        border-radius: 8px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .modal-header {
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-title {
        margin: 0;
        font-size: 24px;
    }
    
    .close-modal {
        font-size: 24px;
        cursor: pointer;
        color: #7f8c8d;
    }
    
    .close-modal:hover {
        color: #333;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .modal-footer {
        padding: 20px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    /* ËÆ¢ÂçïÂéÜÂè≤Ê†∑Âºè */
    .order-history {
        margin-top: 40px;
    }
    
    .order-item {
        background-color: #fff;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .order-id {
        font-weight: 600;
        color: #34495e;
    }
    
    .order-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
    }
    
    .status-pending {
        background-color: #fff3cd;
        color: #856404;
    }
    
    .status-confirmed {
        background-color: #d4edda;
        color: #155724;
    }
    
    .status-cancelled {
        background-color: #f8d7da;
        color: #721c24;
    }
    
    .order-details {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
    }
    
    .detail-item {
        display: flex;
        flex-direction: column;
    }
    
    .detail-label {
        font-size: 14px;
        color: #7f8c8d;
        margin-bottom: 5px;
    }
    
    .detail-value {
        font-weight: 500;
    }
    
    .order-actions {
        margin-top: 20px;
        display: flex;
        gap: 10px;
    }
</style>
{% endblock %}

{% block content %}
<h1>ËµÑÊ∫êÈ¢ÑÂÆö</h1>
<p>È¢ÑËÆ¢ÊÇ®ÁöÑÂÆåÁæéÊóÖÁ®ãÔºåÂåÖÊã¨ÈÖíÂ∫ó„ÄÅÊôØÂå∫Èó®Á•®ÂíåÁâπËâ≤È§êÈ•Æ„ÄÇ</p>

<!-- È¢ÑÂÆöÊ†áÁ≠æÈ°µ -->
<div class="booking-tabs">
    <div class="booking-tab active" data-tab="hotels">ÈÖíÂ∫ó</div>
    <div class="booking-tab" data-tab="attractions">ÊôØÂå∫</div>
    <div class="booking-tab" data-tab="restaurants">È§êÈ•Æ</div>
    <div class="booking-tab" data-tab="history">ËÆ¢ÂçïÂéÜÂè≤</div>
</div>

<!-- ÈÖíÂ∫óÂÜÖÂÆπ -->
<div class="booking-content active" id="hotels-content">
    <!-- ËµÑÊ∫êÁΩëÊ†ºÈÉ®ÂàÜ‰øùÊåÅ‰∏çÂèò -->
    <div class="resource-grid">
        <!-- Âä®ÊÄÅÁîüÊàêÈÖíÂ∫óÂàóË°® - ÊåâÊúçÂä°Á±ªÂà´ÂàõÂª∫ÂçïÁã¨Âç°Áâá -->
        {% for hotel in hotels %}
            {% if hotel.service_category_ratings and hotel.service_category_ratings|length > 0 %}
                <!-- ÊúâÊúçÂä°Á±ªÂà´ËØÑÂàÜÊó∂Ôºå‰∏∫ÊØè‰∏™ÊúçÂä°Á±ªÂà´ÂàõÂª∫ÂçïÁã¨Âç°Áâá -->
                {% for service_category, rating_info in hotel.service_category_ratings.items() %}
                <div class="resource-card" data-id="{{ hotel.merchant_id }}" data-type="hotel" data-service="{{ service_category }}">
                    <div class="resource-image">
                        {% if hotel.images and hotel.images|length > 0 %}
                        <img src="{{ hotel.images[0] }}" alt="{{ service_category }}">
                        {% else %}
                        <img src="https://picsum.photos/id/1031/800/500" alt="{{ service_category }}">
                        {% endif %}
                    </div>
                    <div class="resource-content">
                        <h3 class="resource-title">{{ service_category }}</h3>
                        <div class="resource-location">
                            <i class="icon-map-marker">üìç</i>
                            <span>{{ hotel.address }}</span>
                        </div>
                        
                        <!-- ÊúçÂä°Á±ªÂà´ËØÑÂàÜ -->
                        <div class="resource-rating">
                            <div class="star-rating">
                                {% for i in range(5) %}
                                    {% if i < rating_info.avg_rating | int %}
                                        <span class="star filled">‚òÖ</span>
                                    {% else %}
                                        <span class="star">‚òÜ</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <span class="rating-score">{{ "%.1f"|format(rating_info.avg_rating) }}</span>
                            <span class="review-count">({{ rating_info.review_count }}Êù°ËØÑ‰ª∑)</span>
                        </div>
                        
                        <p>{{ hotel.description }}</p>
                        <div class="resource-price">
                            <div>
                                <span class="price-value">¬•{{ hotel.price_range }}</span>
                                <span class="price-unit">/ÊôöËµ∑</span>
                            </div>
                            <button class="btn btn-primary book-now" data-merchant-id="{{ hotel.merchant_id }}" data-service="{{ service_category }}">Á´ãÂç≥È¢ÑËÆ¢</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Ê≤°ÊúâÊúçÂä°Á±ªÂà´ËØÑÂàÜÊó∂ÔºåÊòæÁ§∫ÂéüÂßãÈÖíÂ∫óÂç°Áâá -->
                <div class="resource-card" data-id="{{ hotel.merchant_id }}" data-type="hotel">
                    <div class="resource-image">
                        {% if hotel.images and hotel.images|length > 0 %}
                        <img src="{{ hotel.images[0] }}" alt="{{ hotel.name }}">
                        {% else %}
                        <img src="https://picsum.photos/id/1031/800/500" alt="{{ hotel.name }}">
                        {% endif %}
                    </div>
                    <div class="resource-content">
                        <h3 class="resource-title">{{ hotel.merchant_name }}</h3>
                        <div class="resource-location">
                            <i class="icon-map-marker">üìç</i>
                            <span>{{ hotel.address }}</span>
                        </div>
                        
                        <!-- ËØÑÂàÜÊòæÁ§∫ -->
                        <div class="resource-rating">
                            <div class="star-rating">
                                {% for i in range(5) %}
                                    {% if i < hotel.avg_rating | int %}
                                        <span class="star filled">‚òÖ</span>
                                    {% else %}
                                        <span class="star">‚òÜ</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <span class="rating-score">{{ "%.1f"|format(hotel.avg_rating) }}</span>
                            <span class="review-count">({{ hotel.review_count }}Êù°ËØÑ‰ª∑)</span>
                        </div>
                        
                        <p>{{ hotel.description }}</p>
                        <div class="resource-price">
                            <div>
                                <span class="price-value">¬•{{ hotel.price_range }}</span>
                                <span class="price-unit">/ÊôöËµ∑</span>
                            </div>
                            <button class="btn btn-primary book-now" data-merchant-id="{{ hotel.merchant_id }}">Á´ãÂç≥È¢ÑËÆ¢</button>
                        </div>                    
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    
    <div class="pagination">
        <a href="#" class="page-item">‰∏ä‰∏ÄÈ°µ</a>
        <a href="#" class="page-item active">1</a>
        <a href="#" class="page-item">2</a>
        <a href="#" class="page-item">3</a>
        <span class="page-item">...</span>
        <a href="#" class="page-item">10</a>
        <a href="#" class="page-item">‰∏ã‰∏ÄÈ°µ</a>
    </div>
</div>

<!-- ÊôØÂå∫ÂÜÖÂÆπ -->
<div class="booking-content" id="attractions-content">
    <div class="resource-grid">
        <!-- Âä®ÊÄÅÁîüÊàêÊôØÂå∫ÂàóË°® - ÊåâÊúçÂä°Á±ªÂà´ÂàõÂª∫ÂçïÁã¨Âç°Áâá -->
        {% for attraction in attractions %}
            {% if attraction.service_category_ratings and attraction.service_category_ratings|length > 0 %}
                <!-- ÊúâÊúçÂä°Á±ªÂà´ËØÑÂàÜÊó∂Ôºå‰∏∫ÊØè‰∏™ÊúçÂä°Á±ªÂà´ÂàõÂª∫ÂçïÁã¨Âç°Áâá -->
                {% for service_category, rating_info in attraction.service_category_ratings.items() %}
                <div class="resource-card" data-id="{{ attraction.merchant_id }}" data-type="attraction" data-service="{{ service_category }}">
                    <div class="resource-image">
                        {% if attraction.images and attraction.images|length > 0 %}
                        <img src="{{ attraction.images[0] }}" alt="{{ attraction.merchant_name }}">
                        {% else %}
                        <img src="https://picsum.photos/id/1036/800/500" alt="{{ attraction.merchant_name }}">
                        {% endif %}
                    </div>
                    <div class="resource-content">
                        <h3 class="resource-title">{{ attraction.merchant_name }}</h3>
                        <div class="resource-subtitle">{{ service_category }}</div>
                        <div class="resource-location">
                            <i class="icon-map-marker">üìç</i>
                            <span>{{ attraction.address }}</span>
                        </div>
                        
                        <!-- ÊúçÂä°Á±ªÂà´ËØÑÂàÜ -->
                        <div class="resource-rating">
                            <div class="star-rating">
                                {% for i in range(5) %}
                                    {% if i < rating_info.avg_rating | int %}
                                        <span class="star filled">‚òÖ</span>
                                    {% else %}
                                        <span class="star">‚òÜ</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <span class="rating-score">{{ "%.1f"|format(rating_info.avg_rating) }}</span>
                            <span class="review-count">({{ rating_info.review_count }}Êù°ËØÑ‰ª∑)</span>
                        </div>
                        
                        <p>{{ attraction.description }}</p>
                        <div class="resource-price">
                            <div>
                                <span class="price-value">¬•{{ attraction.price_range }}</span>
                                <span class="price-unit">/‰∫∫Ëµ∑</span>
                            </div>
                            <button class="btn btn-primary book-now" data-merchant-id="{{ attraction.merchant_id }}" data-service="{{ service_category }}">Á´ãÂç≥È¢ÑËÆ¢</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Ê≤°ÊúâÊúçÂä°Á±ªÂà´ËØÑÂàÜÊó∂ÔºåÊòæÁ§∫ÂéüÂßãÊôØÂå∫Âç°Áâá -->
                <div class="resource-card" data-id="{{ attraction.merchant_id }}" data-type="attraction">
                    <div class="resource-image">
                        {% if attraction.images and attraction.images|length > 0 %}
                        <img src="{{ attraction.images[0] }}" alt="{{ attraction.merchant_name }}">
                        {% else %}
                        <img src="https://picsum.photos/id/1036/800/500" alt="{{ attraction.merchant_name }}">
                        {% endif %}
                    </div>
                    <div class="resource-content">
                        <h3 class="resource-title">{{ attraction.merchant_name }}</h3>
                        <div class="resource-location">
                            <i class="icon-map-marker">üìç</i>
                            <span>{{ attraction.address }}</span>
                        </div>
                        
                        <!-- ÊôØÂå∫ËØÑÂàÜÊòæÁ§∫ -->
                        <div class="resource-rating">
                            <div class="star-rating">
                                {% for i in range(5) %}
                                    {% if i < attraction.avg_rating | int %}
                                        <span class="star filled">‚òÖ</span>
                                    {% else %}
                                        <span class="star">‚òÜ</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <span class="rating-score">{{ "%.1f"|format(attraction.avg_rating) }}</span>
                            <span class="review-count">({{ attraction.review_count }}Êù°ËØÑ‰ª∑)</span>
                        </div>
                        
                        <p>{{ attraction.description }}</p>
                        <div class="resource-price">
                            <div>
                                <span class="price-value">¬•{{ attraction.price_range }}</span>
                                <span class="price-unit">/‰∫∫Ëµ∑</span>
                            </div>
                            <button class="btn btn-primary book-now" data-merchant-id="{{ attraction.merchant_id }}">Á´ãÂç≥È¢ÑËÆ¢</button>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<!-- È§êÂéÖÂÜÖÂÆπ -->
<div class="booking-content" id="restaurants-content">
    <div class="resource-grid">
        <!-- Âä®ÊÄÅÁîüÊàêÈ§êÂéÖÂàóË°® - ÊåâÊúçÂä°Á±ªÂà´ÂàõÂª∫ÂçïÁã¨Âç°Áâá -->
        {% for restaurant in restaurants %}
        <div class="resource-card" data-id="{{ restaurant.merchant_id }}" data-type="restaurant">
            <div class="resource-image">
                {% if restaurant.images and restaurant.images|length > 0 %}
                <img src="{{ restaurant.images[0] }}" alt="{{ restaurant.merchant_name }}">
                {% else %}
                <img src="https://picsum.photos/id/292/800/500" alt="{{ restaurant.merchant_name }}">
                {% endif %}
            </div>
            <div class="resource-content">
                <h3 class="resource-title">{{ restaurant.merchant_name }}</h3>
                <div class="resource-location">
                    <i class="icon-map-marker">üìç</i>
                    <span>{{ restaurant.address }}</span>
                </div>
                
                <!-- È§êÂéÖËØÑÂàÜÊòæÁ§∫ -->
                {% if restaurant.shop_info and restaurant.feedback_info %}
                <div class="resource-rating">
                    <div class="star-rating">
                        {% for i in range(5) %}
                            {% if i < restaurant.feedback_info.avg_rating | int %}
                                <span class="star filled">‚òÖ</span>
                            {% else %}
                                <span class="star">‚òÜ</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <span class="rating-score">{{ "%.1f"|format(restaurant.feedback_info.avg_rating) }}</span>
                    <span class="review-count">({{ restaurant.feedback_info.review_count }}Êù°ËØÑ‰ª∑)</span>
                </div>
                {% else %}
                <div class="resource-rating">
                    <div class="star-rating">
                        {% for i in range(5) %}
                            {% if i < restaurant.avg_rating | int %}
                                <span class="star filled">‚òÖ</span>
                            {% else %}
                                <span class="star">‚òÜ</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <span class="rating-score">{{ "%.1f"|format(restaurant.avg_rating) }}</span>
                    <span class="review-count">({{ restaurant.review_count }}Êù°ËØÑ‰ª∑)</span>
                </div>
                {% endif %}
                
                <p>{{ restaurant.description }}</p>
                <div class="resource-price">
                    <div>
                        <span class="price-value">¬•{{ restaurant.price_range }}</span>
                        <span class="price-unit">/‰∫∫Ëµ∑</span>
                    </div>
                    <button class="btn btn-primary book-now">Á´ãÂç≥È¢ÑËÆ¢</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- ËÆ¢ÂçïÂéÜÂè≤ÂÜÖÂÆπ -->
<div class="booking-content" id="history-content">
    <div class="order-history">
        <h3>ÊàëÁöÑËÆ¢Âçï</h3>
        <div style="text-align: center; padding: 40px; color: #666;">
            <p>ÁÇπÂáª‰∏äÊñπ"ËÆ¢ÂçïÂéÜÂè≤"Ê†áÁ≠æÂä†ËΩΩÊÇ®ÁöÑËÆ¢Âçï</p>
        </div>
    </div>
</div>

<!-- È¢ÑËÆ¢Ê®°ÊÄÅÊ°Ü -->
<div class="booking-modal" id="booking-modal">
    <div class="modal-dialog">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-resource-title">È¢ÑËÆ¢Á°ÆËÆ§</h2>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <form id="booking-form">
                <input type="hidden" id="resource-id" name="resource_id">
                <input type="hidden" id="resource-type" name="resource_type">
                
                <div id="booking-fields">
                    <!-- È¢ÑËÆ¢Â≠óÊÆµÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                </div>
                
                <div class="form-group">
                    <label for="contact-name">ËÅîÁ≥ª‰∫∫ÂßìÂêç</label>
                    <input type="text" id="contact-name" name="contact_name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="contact-phone">ËÅîÁ≥ªÁîµËØù</label>
                    <input type="tel" id="contact-phone" name="contact_phone" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-check-label">
                        <input type="checkbox" name="agree_terms" class="form-check-input" required>
                        ÊàëÂ∑≤ÈòÖËØªÂπ∂ÂêåÊÑè<a href="#" target="_blank">È¢ÑËÆ¢Êù°Ê¨æ</a>Âíå<a href="#" target="_blank">ÈÄÄÊ¨æÊîøÁ≠ñ</a>
                    </label>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary close-modal">ÂèñÊ∂à</button>
            <button type="submit" form="booking-form" class="btn btn-primary">Êèê‰∫§È¢ÑËÆ¢</button>
        </div>
    </div>
</div>

{% endblock %}
{% block js %}
<script>
// Âä†ËΩΩÁî®Êà∑ËÆ¢Âçï
function loadUserOrders() {
    showLoading();
    
    fetch('/user_orders', {
        method: 'GET',
        credentials: 'same-origin'
    })
    .then(response => {
        if (response.status === 401) {
            hideLoading();
            showAlert('ËØ∑ÂÖàÁôªÂΩï‰ª•Êü•ÁúãËÆ¢ÂçïÂéÜÂè≤', 'info');
            return null;
        }
        return response.json();
    })
    .then(data => {
        hideLoading();
        if (data && data.success) {
            renderOrders(data.orders);
        } else if (data) {
            showAlert(data.message || 'Ëé∑ÂèñËÆ¢ÂçïÂ§±Ë¥•', 'error');
        }
    })
    .catch(error => {
        hideLoading();
        showAlert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
    });
}

// Ê∏≤ÊüìËÆ¢ÂçïÂàóË°® - ‰ºòÂåñÁâàÔºàÈò≤Ê≠¢ÈáçÂ§çËÆ¢ÂçïÔºâ
function renderOrders(orders) {
    const orderHistoryContainer = document.querySelector('#history-content .order-history');
    
    // È™åËØÅÂÆπÂô®ÊòØÂê¶Â≠òÂú®
    if (!orderHistoryContainer) {
        console.error('ËÆ¢ÂçïÂÆπÂô®ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
        return;
    }
    
    // Ê∏ÖÁ©∫ÂÆπÂô®ÔºàÂÖ≥ÈîÆÔºöÈò≤Ê≠¢ÈáçÂ§çËøΩÂä†Ôºâ
    orderHistoryContainer.innerHTML = '';
    
    if (orders.length === 0) {
        orderHistoryContainer.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #666;">
                <h4>ÊöÇÊó†ËÆ¢Âçï</h4>
                <p>ÊÇ®ËøòÊ≤°Êúâ‰ªª‰ΩïÈ¢ÑËÆ¢ËÆ∞ÂΩï</p>
            </div>
        `;
        return;
    }
    
    // ÂéªÈáçÂ§ÑÁêÜÔºöÈÄöËøáËÆ¢ÂçïIDÁ°Æ‰øùÂîØ‰∏ÄÊÄß
    const uniqueOrders = Array.from(
        new Map(orders.map(order => [order.id, order])).values()
    );
    
    let ordersHtml = '<h3>ÊàëÁöÑËÆ¢Âçï</h3>';
    
    uniqueOrders.forEach(order => {
        // Ê†ºÂºèÂåñÁä∂ÊÄÅÊòæÁ§∫
        let statusClass = 'status-pending';
        let statusText = 'Â§ÑÁêÜ‰∏≠';
        if (order.status === 'confirmed') {
            statusClass = 'status-confirmed';
            statusText = 'Â∑≤Á°ÆËÆ§';
        } else if (order.status === 'cancelled') {
            statusClass = 'status-cancelled';
            statusText = 'Â∑≤ÂèñÊ∂à';
        }
        
        // Á°ÆÂÆöÊó•ÊúüÊ†áÁ≠æÊñáÊú¨
        const dateLabel = order.category === 'hotel' ? 'ÂÖ•‰Ωè' : 
                          order.category === 'restaurant' ? 'Áî®È§ê' : 'ÂèÇËßÇ';
        
        ordersHtml += `
            <div class="order-item" data-order-id="${order.id}">
                <div class="order-header">
                    <div class="order-id">ËÆ¢ÂçïÁºñÂè∑ÔºöORD-${order.id}</div>
                    <div class="order-status ${statusClass}">${statusText}</div>
                </div>
                <div class="order-details">
                    <div class="detail-item">
                        <div class="detail-label">È¢ÑËÆ¢È°πÁõÆ</div>
                        <div class="detail-value">${order.service_name}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">${dateLabel}Êó•Êúü</div>
                        <div class="detail-value">${order.service_start_time ? order.service_start_time.split(' ')[0] : 'Êú™ËÆæÁΩÆ'}</div>
                    </div>
                    ${order.category === 'hotel' && order.service_end_time ? `
                    <div class="detail-item">
                        <div class="detail-label">Á¶ªÂ∫óÊó•Êúü</div>
                        <div class="detail-value">${order.service_end_time.split(' ')[0]}</div>
                    </div>
                    ` : ''}
                    <div class="detail-item">
                        <div class="detail-label">ÊÄªÈáëÈ¢ù</div>
                        <div class="detail-value">¬•${order.price || 0}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">È¢ÑËÆ¢Êó∂Èó¥</div>
                        <div class="detail-value">${order.book_time || 'Êú™Áü•Êó∂Èó¥'}</div>
                    </div>
                </div>
                <div class="order-actions">
                    ${order.status === 'confirmed' ? '<button class="btn btn-secondary cancel-order" data-id="' + order.id + '">Áî≥ËØ∑ÈÄÄËÆ¢</button>' : ''}
                </div>
            </div>
        `;
    });
    
    orderHistoryContainer.innerHTML = ordersHtml;
    // Âú®ËÆ¢ÂçïÊ∏≤ÊüìÂÆåÊàêÂêéÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
    bindOrderActionEvents();
}

// ÁªëÂÆöËÆ¢ÂçïÊìç‰ΩúÊåâÈíÆ‰∫ã‰ª∂
function bindOrderActionEvents() {
    const cancelButtons = document.querySelectorAll('.cancel-order');
    cancelButtons.forEach(button => {
        button.addEventListener('click', function() {
            const orderId = this.getAttribute('data-id');
            
            if (confirm('Á°ÆÂÆöË¶ÅÁî≥ËØ∑ÈÄÄËÆ¢Ê≠§ËÆ¢ÂçïÂêóÔºü')) {
                showLoading();
                
                // ÂèëÈÄÅÈÄÄËÆ¢ËØ∑Ê±ÇÂà∞ÂêéÁ´Ø
                fetch('/cancel_order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ order_id: orderId })
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showAlert(data.message, 'success');
                        // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÂçïÂàóË°®
                        loadUserOrders();
                    } else {
                        showAlert(data.message, 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showAlert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
                });
            }
        });
    });
}

// Âú®È°µÈù¢Âä†ËΩΩÊó∂ÁõëÂê¨ËÆ¢ÂçïÂéÜÂè≤Ê†áÁ≠æÁÇπÂáª‰∫ã‰ª∂
document.addEventListener('DOMContentLoaded', function() {
    // ÁõëÂê¨ËÆ¢ÂçïÂéÜÂè≤Ê†áÁ≠æÁÇπÂáª
    const historyTab = document.querySelector('.booking-tab[data-tab="history"]');
    if (historyTab) {
        historyTab.addEventListener('click', function() {
            loadUserOrders();
        });
    }
});
    // Âú®<script>Ê†áÁ≠æÂºÄÂßãÂ§ÑÊ∑ªÂä†‰ª•‰∏ãÂáΩÊï∞ÂÆö‰πâ
    function showLoading() {
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊúâÂä†ËΩΩÂÖÉÁ¥†ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôÂàõÂª∫
        let loadingElement = document.getElementById('loading-overlay');
        if (!loadingElement) {
            loadingElement = document.createElement('div');
            loadingElement.id = 'loading-overlay';
            loadingElement.style.position = 'fixed';
            loadingElement.style.top = '0';
            loadingElement.style.left = '0';
            loadingElement.style.width = '100%';
            loadingElement.style.height = '100%';
            loadingElement.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            loadingElement.style.display = 'flex';
            loadingElement.style.justifyContent = 'center';
            loadingElement.style.alignItems = 'center';
            loadingElement.style.zIndex = '1000';
            loadingElement.innerHTML = '<div style="background-color: white; padding: 20px; border-radius: 8px;">Â§ÑÁêÜ‰∏≠...</div>';
            document.body.appendChild(loadingElement);
        }
        loadingElement.style.display = 'flex';
    }
    
    function hideLoading() {
        const loadingElement = document.getElementById('loading-overlay');
        if (loadingElement) {
            loadingElement.style.display = 'none';
        }
    }
    
    function showAlert(message, type = 'info') {
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊúâÊèêÁ§∫ÂÖÉÁ¥†ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôÂàõÂª∫
        let alertElement = document.getElementById('custom-alert');
        if (!alertElement) {
            alertElement = document.createElement('div');
            alertElement.id = 'custom-alert';
            alertElement.style.position = 'fixed';
            alertElement.style.top = '20px';
            alertElement.style.left = '50%';
            alertElement.style.transform = 'translateX(-50%)';
            alertElement.style.padding = '15px 20px';
            alertElement.style.borderRadius = '8px';
            alertElement.style.color = 'white';
            alertElement.style.fontWeight = '500';
            alertElement.style.zIndex = '1001';
            alertElement.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
            alertElement.style.transition = 'opacity 0.3s ease';
            document.body.appendChild(alertElement);
        }
        
        // ËÆæÁΩÆÊèêÁ§∫Á±ªÂûãÂØπÂ∫îÁöÑËÉåÊôØÈ¢úËâ≤
        if (type === 'success') {
            alertElement.style.backgroundColor = '#28a745'; // ÁªøËâ≤
        } else if (type === 'error') {
            alertElement.style.backgroundColor = '#dc3545'; // Á∫¢Ëâ≤
        } else if (type === 'info') {
            alertElement.style.backgroundColor = '#17a2b8'; // ËìùËâ≤
        } else {
            alertElement.style.backgroundColor = '#6c757d'; // ÁÅ∞Ëâ≤
        }
        
        // ËÆæÁΩÆÊèêÁ§∫‰ø°ÊÅØÂπ∂ÊòæÁ§∫
        alertElement.textContent = message;
        alertElement.style.opacity = '1';
        
        // 3ÁßíÂêéËá™Âä®ÈöêËóè
        setTimeout(() => {
            alertElement.style.opacity = '0';
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 300);
        }, 3000);
    }
    
    // ÂÖ®Â±ÄÂïÜÂÆ∂ÊúçÂä°Êï∞ÊçÆ
    window.merchantServices = {{ merchant_services | tojson | safe }} || {};
    
    document.addEventListener('DOMContentLoaded', function() {
        // Ê†áÁ≠æÈ°µÂàáÊç¢ÂäüËÉΩ
        const bookingTabs = document.querySelectorAll('.booking-tab');
        const bookingContents = document.querySelectorAll('.booking-content');
        
        bookingTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // ÁßªÈô§ÊâÄÊúâÊøÄÊ¥ªÁä∂ÊÄÅ
                bookingTabs.forEach(t => t.classList.remove('active'));
                bookingContents.forEach(c => c.classList.remove('active'));
                
                // Ê∑ªÂä†ÂΩìÂâçÊøÄÊ¥ªÁä∂ÊÄÅ
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(`${tabId}-content`).classList.add('active');
            });
        });
        
        // È¢ÑËÆ¢Ê®°ÊÄÅÊ°ÜÁõ∏ÂÖ≥
        const bookingModal = document.getElementById('booking-modal');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        const bookNowButtons = document.querySelectorAll('.book-now');
        const bookingForm = document.getElementById('booking-form');
        const modalResourceTitle = document.getElementById('modal-resource-title');
        const bookingFields = document.getElementById('booking-fields');
        
        // ÊâìÂºÄÈ¢ÑËÆ¢Ê®°ÊÄÅÊ°Ü
        bookNowButtons.forEach(button => {
            button.addEventListener('click', function() {
                const resourceCard = this.closest('.resource-card');
                const resourceId = resourceCard.getAttribute('data-id');
                const resourceType = resourceCard.getAttribute('data-type');
                const resourceTitle = resourceCard.querySelector('.resource-title').textContent;
                
                // ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊ†áÈ¢ò
                modalResourceTitle.textContent = `È¢ÑËÆ¢Ôºö${resourceTitle}`;
                
                // ËÆæÁΩÆÈöêËóèÂ≠óÊÆµ
                document.getElementById('resource-id').value = resourceId;
                document.getElementById('resource-type').value = resourceType;
                
                // Ê†πÊçÆËµÑÊ∫êÁ±ªÂûãÁîüÊàê‰∏çÂêåÁöÑÈ¢ÑËÆ¢Â≠óÊÆµ
                generateBookingFields(resourceType);
                
                // ‰øÆÂ§çÔºöÂêåÊ≠•Á≠õÈÄâÊ†è‰∏≠ÁöÑÊó•ÊúüÂà∞È¢ÑËÆ¢Ê®°ÊÄÅÊ°Ü
                if (resourceType === 'hotel') {
                    const filterCheckin = document.getElementById('hotel-checkin');
                    const modalCheckin = document.getElementById('modal-hotel-checkin');
                    if (filterCheckin && filterCheckin.value && modalCheckin) {
                        modalCheckin.value = filterCheckin.value;
                    }
                    const filterCheckout = document.getElementById('hotel-checkout');
                    const modalCheckout = document.getElementById('modal-hotel-checkout');
                    if (filterCheckout && filterCheckout.value && modalCheckout) {
                        modalCheckout.value = filterCheckout.value;
                    }
                } else if (resourceType === 'restaurant') {
                    const filterDate = document.getElementById('restaurant-date');
                    const modalDate = document.getElementById('modal-restaurant-date');
                    if (filterDate && filterDate.value && modalDate) {
                        modalDate.value = filterDate.value;
                    }
                    const filterTime = document.getElementById('restaurant-time');
                    const modalTime = document.getElementById('modal-restaurant-time');
                    if (filterTime && filterTime.value && modalTime) {
                        modalTime.value = filterTime.value;
                    }
                }
                
                // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                bookingModal.classList.add('active');
            });
        });
        
        // ÂÖ≥Èó≠È¢ÑËÆ¢Ê®°ÊÄÅÊ°Ü
        closeModalButtons.forEach(button => {
            button.addEventListener('click', function() {
                bookingModal.classList.remove('active');
            });
        });
        
        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        bookingModal.addEventListener('click', function(e) {
            if (e.target === bookingModal) {
                bookingModal.classList.remove('active');
            }
        });
        
        // Ê†πÊçÆËµÑÊ∫êÁ±ªÂûãÁîüÊàêÈ¢ÑËÆ¢Â≠óÊÆµ
        function generateBookingFields(resourceType) {
            let fieldsHtml = '';
            const resourceTitle = document.getElementById('modal-resource-title').textContent.replace('È¢ÑËÆ¢Ôºö', '');
            
            if (resourceType === 'hotel') {
                // Ëé∑ÂèñÂΩìÂâçÈÖíÂ∫óÁöÑÊúçÂä°È°πÁõÆ
                const hotelServices = window.merchantServices[resourceTitle] || [];
                
                let roomOptions = '<option value="">ËØ∑ÈÄâÊã©ÊàøÂûã</option>';
                hotelServices.forEach(service => {
                    roomOptions += `<option value="${service.name}">${service.name}  ¬•${service.price}</option>`;
                });
                
                // Â¶ÇÊûúÊ≤°ÊúâÊúçÂä°È°πÁõÆÔºå‰ΩøÁî®ÈªòËÆ§ÈÄâÈ°π
                if (hotelServices.length === 0) {
                    roomOptions = `
                        <option value="standard">Ê†áÂáÜÈó¥</option>
                        <option value="deluxe">Ë±™ÂçéÈó¥</option>
                        <option value="suite">Â•óÊàø</option>
                    `;
                }
                
                fieldsHtml = `
                    <div class="form-group">
                        <label for="hotel-checkin">ÂÖ•‰ΩèÊó•Êúü</label>
                        <input type="date" id="modal-hotel-checkin" name="checkin_date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hotel-checkout">Á¶ªÂ∫óÊó•Êúü</label>
                        <input type="date" id="modal-hotel-checkout" name="checkout_date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hotel-room-type">ÊàøÂûã</label>
                        <select id="hotel-room-type" name="room_type" class="form-control" required>
                            ${roomOptions}
                        </select>
                    </div>
                `;
            } else if (resourceType === 'restaurant') {
                // Ëé∑ÂèñÂΩìÂâçÈ§êÂéÖÁöÑÊúçÂä°È°πÁõÆ
                const restaurantServices = window.merchantServices[resourceTitle] || [];
                
                let menuOptions = '<option value="">‰∏çÈÄâÊã©Â•óÈ§ê</option>';
                restaurantServices.forEach(service => {
                    menuOptions += `<option value="${service.name}">${service.name}  ¬•${service.price}</option>`;
                });
                
                fieldsHtml = `
                    <div class="form-group">
                        <label for="restaurant-date">Áî®È§êÊó•Êúü</label>
                        <input type="date" id="modal-restaurant-date" name="dining_date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="restaurant-time">Áî®È§êÊó∂Èó¥</label>
                        <input type="time" id="modal-restaurant-time" name="dining_time" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="modal-restaurant-menu">Â•óÈ§êÈÄâÊã©ÔºàÂèØÈÄâÔºâ</label>
                        <select id="modal-restaurant-menu" name="menu" class="form-control">
                            ${menuOptions}
                        </select>
                    </div>
                `;
            } else if (resourceType === 'attraction') {
                fieldsHtml = `
                    <div class="form-group">
                        <label for="attraction-date">ÂèÇËßÇÊó•Êúü</label>
                        <input type="date" id="modal-attraction-date" name="visit_date" class="form-control" required>
                    </div>
                `;
            }
            bookingFields.innerHTML = fieldsHtml;
        }
        
// Êèê‰∫§È¢ÑËÆ¢Ë°®Âçï
bookingForm.addEventListener('submit', function(e) {
    e.preventDefault();
    showLoading();
    
    // Êî∂ÈõÜË°®ÂçïÊï∞ÊçÆ
    const formData = {
        merchant_id: document.getElementById('resource-id').value,
        category: document.getElementById('resource-type').value,
        service_name: document.getElementById('modal-resource-title').textContent.replace('È¢ÑËÆ¢Ôºö', ''),
        customer_name: document.getElementById('contact-name').value,
        phonenumber: document.getElementById('contact-phone').value,
        price: 0 // ÈúÄË¶ÅÊ†πÊçÆÈÄâÊã©ÁöÑÊàøÂûã/Â•óÈ§êËé∑Âèñ‰ª∑Ê†º
    };
    
    // Ê†πÊçÆËµÑÊ∫êÁ±ªÂûãÊ∑ªÂä†ÁâπÂÆöÂ≠óÊÆµ
    const resourceType = formData.category;
    if (resourceType === 'hotel') {
        // Ëé∑ÂèñÈÖíÂ∫óÊó•ÊúüÂπ∂È™åËØÅ
        const checkinDate = document.getElementById('modal-hotel-checkin').value;
        const checkoutDate = document.getElementById('modal-hotel-checkout').value;
        
        // È™åËØÅÊó•ÊúüÈ°∫Â∫è
        if (checkinDate > checkoutDate) {
            showAlert('ÂÖ•‰ΩèÊó•Êúü‰∏çËÉΩÊôö‰∫éÁ¶ªÂ∫óÊó•Êúü', 'error');
            hideLoading();
            return;
        }
        
        if (!checkinDate || !checkoutDate) {
        showAlert('ËØ∑ÈÄâÊã©ÂÖ•‰ΩèÂíåÁ¶ªÂ∫óÊó•Êúü', 'error');
        hideLoading();
        return;
        }
        
        formData.service_start_time = checkinDate + ' 14:00:00';
        formData.service_end_time = checkoutDate + ' 12:00:00';
        
        // Ëé∑ÂèñÊàøÂûã‰ª∑Ê†º
        const roomSelect = document.getElementById('hotel-room-type');
        const selectedOption = roomSelect.options[roomSelect.selectedIndex];
        if (selectedOption.value) {
            const priceMatch = selectedOption.text.match(/¬•(\d+)/);
            if (priceMatch) {
                formData.price = priceMatch[1];
            }
        }
    } else if (resourceType === 'restaurant') {
        const diningDate = document.getElementById('modal-restaurant-date').value;
        const diningTime = document.getElementById('modal-restaurant-time').value;
        
        // Ê∑ªÂä†Êó•ÊúüÈ™åËØÅ
        if (!diningDate) {
            showAlert('ËØ∑ÈÄâÊã©Áî®È§êÊó•Êúü', 'error');
            hideLoading();
            return;
        }
        
        // Á°Æ‰øùÊó∂Èó¥Ê†ºÂºèÊ≠£Á°Æ
        if (diningTime && diningTime.includes(':')) {
            const [hours, minutes] = diningTime.split(':');
            formData.service_start_time = `${diningDate} ${hours}:${minutes}:00`;
            
            // ËÆ°ÁÆóÁªìÊùüÊó∂Èó¥ÔºàÁî®È§êÊó∂Èó¥+2Â∞èÊó∂Ôºâ
            const endHours = (parseInt(hours) + 2) % 24;
            const formattedEndHours = endHours.toString().padStart(2, '0');
            formData.service_end_time = `${diningDate} ${formattedEndHours}:${minutes}:00`;
        } else {
            // Â¶ÇÊûúÊó∂Èó¥Ê†ºÂºèÊó†ÊïàÔºå‰ΩøÁî®ÈªòËÆ§ÂÄº
            formData.service_start_time = `${diningDate} 12:00:00`;
            formData.service_end_time = `${diningDate} 14:00:00`;
        }
        
        // Ëé∑ÂèñÂ•óÈ§ê‰ª∑Ê†º - ‰øÆÊîπID‰∏∫Ê≠£Á°ÆÁöÑmodal-restaurant-menu
        const menuSelect = document.getElementById('modal-restaurant-menu');
        if (menuSelect && menuSelect.selectedIndex >= 0) {
            const selectedOption = menuSelect.options[menuSelect.selectedIndex];
            if (selectedOption.value) {
                const priceMatch = selectedOption.text.match(/¬•(\d+)/);
                if (priceMatch) {
                    formData.price = priceMatch[1];
                }
            }
        }
    } else if (resourceType === 'attraction') {        
        const visitDate = document.getElementById('modal-attraction-date').value;
        
        // Ê∑ªÂä†Êó•ÊúüÈ™åËØÅ
        if (!visitDate) {
            showAlert('ËØ∑ÈÄâÊã©ÂèÇËßÇÊó•Êúü', 'error');
            hideLoading();
            return;
        }
        
        formData.service_start_time = `${visitDate} 09:00:00`;
        formData.service_end_time = `${visitDate} 17:00:00`;
        // ‰øÆÂ§çÔºö‰ªémerchant_services‰∏≠ÊèêÂèñÊôØÂå∫ÊúçÂä°‰ª∑Ê†º
        const resourceTitle = document.getElementById('modal-resource-title').textContent.replace('È¢ÑËÆ¢Ôºö', '');
        const attractionServices = window.merchantServices[resourceTitle] || [];
    
        if (attractionServices.length > 0) {
            // ‰ΩøÁî®Á¨¨‰∏Ä‰∏™ÊúçÂä°È°πÁõÆÁöÑ‰ª∑Ê†º
            formData.price = attractionServices[0].price || 0;
        } else {
        // Â¶ÇÊûúÊ≤°ÊúâÊúçÂä°È°πÁõÆÔºå‰ΩøÁî®ÈªòËÆ§‰ª∑Ê†º50ÂÖÉ
            formData.price = 50;
        }
    }
    
    // ÂèëÈÄÅAJAXËØ∑Ê±ÇÂà∞ÂêéÁ´Ø
    fetch('/submit_booking', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        hideLoading();
        bookingModal.classList.remove('active');
        
        if (data.success) {
            showAlert(data.message, 'success');
            bookingForm.reset();
        } else {
            showAlert(data.message, 'error');
        }
    })
    .catch(error => {
        hideLoading();
        showAlert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
    });
});

        // ÊêúÁ¥¢ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        document.getElementById('hotel-search').addEventListener('click', function() {
            performSearch('hotel');
        });
        
        document.getElementById('attraction-search').addEventListener('click', function() {
            performSearch('attraction');
        });
        
        document.getElementById('restaurant-search').addEventListener('click', function() {
            performSearch('restaurant');
        });
        
        // ÊâßË°åÊêúÁ¥¢
        function performSearch(type) {
            showLoading();
            
            // Ê®°ÊãüÊêúÁ¥¢ËØ∑Ê±Ç
            setTimeout(() => {
                hideLoading();
                showAlert(`Â∑≤‰∏∫ÊÇ®ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑ${type === 'hotel' ? 'ÈÖíÂ∫ó' : type === 'attraction' ? 'ÊôØÂå∫' : 'È§êÂéÖ'}ÔºåËØ∑Êü•Áúã‰∏ãÊñπÁªìÊûú„ÄÇ`, 'success');
            }, 1500);
        }
        
        // ËÆ¢ÂçïÊìç‰ΩúÊåâÈíÆ‰∫ã‰ª∂ÔºàÁ∫¶1163-1185Ë°åÔºâ
        const orderButtons = document.querySelectorAll('.order-actions button');
        orderButtons.forEach(button => {
            button.addEventListener('click', function() {
                const action = this.textContent.trim();
                const orderIdElement = this.closest('.order-item').querySelector('.order-id');
                const orderIdText = orderIdElement.textContent;
                
                if (action === 'ÂèñÊ∂àÈ¢ÑËÆ¢' || action === 'Áî≥ËØ∑ÈÄÄËÆ¢') {
                    if (confirm(`Á°ÆÂÆöË¶Å${action}Ê≠§ËÆ¢ÂçïÂêóÔºü`)) {
                        showLoading();
                        
                        // ÊèêÂèñËÆ¢ÂçïIDÔºà‰ªéËÆ¢ÂçïÁºñÂè∑‰∏≠ÊèêÂèñÔºâ
                        const orderId = orderIdText.replace('ËÆ¢ÂçïÁºñÂè∑ÔºöORD-', '');
                        
                        // ÂèëÈÄÅÈÄÄËÆ¢ËØ∑Ê±ÇÂà∞ÂêéÁ´Ø
                        fetch('/cancel_order', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ order_id: orderId })
                        })
                        .then(response => response.json())
                        .then(data => {
                            hideLoading();
                            if (data.success) {
                                showAlert(data.message, 'success');
                                // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÂçïÂàóË°®
                                loadUserOrders();
                            } else {
                                showAlert(data.message, 'error');
                            }
                        })
                        .catch(error => {
                            hideLoading();
                            showAlert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
                        });
                    }
                }
            });
        });
        
        // ËÆæÁΩÆÊó•ÊúüÈÄâÊã©Âô®ÁöÑÊúÄÂ∞èÊó•Êúü‰∏∫‰ªäÂ§©
        const dateInputs = document.querySelectorAll('input[type="date"]');
        const today = new Date().toISOString().split('T')[0];
        dateInputs.forEach(input => {
            input.min = today;
        });
        
        // ‰∏∫ÈÖíÂ∫óÊêúÁ¥¢ÁöÑÁ¶ªÂ∫óÊó•ÊúüËÆæÁΩÆÊúÄÂ∞èÂÄº‰∏∫ÂÖ•‰ΩèÊó•Êúü
        const hotelCheckin = document.getElementById('hotel-checkin');
        const hotelCheckout = document.getElementById('hotel-checkout');
        
        if (hotelCheckin && hotelCheckout) {
            hotelCheckin.addEventListener('change', function() {
                hotelCheckout.min = this.value;
                if (hotelCheckout.value < this.value) {
                    hotelCheckout.value = this.value;
                }
            });
        }
    });
</script>
{% endblock %}