{% extends "layout.html" %}

{% block title %}å•†æˆ·æ³¨å†Œ - æ—…æ¸¸å°åŠ©æ‰‹{% endblock %}

{% block css %}
<style>
    /* å•†æˆ·æ³¨å†Œé¡µé¢æ ·å¼ */
    .merchant-register-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 40px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
        margin-bottom: 30px;
    }
    
    .merchant-register-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .merchant-register-title {
        font-size: 28px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .merchant-register-subtitle {
        color: #7f8c8d;
    }
    
    .merchant-logo {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        background-color: #3498db;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 40px;
    }
    
    /* è¡¨å•æ ·å¼ */
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .form-group {
        flex: 1;
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #34495e;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 4px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3498db;
    }
    
    /* å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨ */
    .password-strength {
        margin-top: 5px;
        height: 5px;
        border-radius: 3px;
        background-color: #eee;
        position: relative;
        overflow: hidden;
    }
    
    .password-strength-bar {
        height: 100%;
        width: 0;
        transition: width 0.3s ease, background-color 0.3s ease;
    }
    
    .strength-weak .password-strength-bar {
        width: 33%;
        background-color: #e74c3c;
    }
    
    .strength-medium .password-strength-bar {
        width: 66%;
        background-color: #f39c12;
    }
    
    .strength-strong .password-strength-bar {
        width: 100%;
        background-color: #27ae60;
    }
    
    .password-strength-text {
        font-size: 14px;
        margin-top: 5px;
        color: #7f8c8d;
    }
    
    /* æŒ‰é’®æ ·å¼ */
    .btn-primary {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 4px;
        background-color: #3498db;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .btn-primary:hover {
        background-color: #2980b9;
    }
    
    .btn-primary:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
    }
    
    /* é“¾æ¥æ ·å¼ */
    .register-links {
        margin-top: 20px;
        text-align: center;
    }
    
    .register-links a {
        color: #3498db;
        text-decoration: none;
        transition: color 0.3s ease;
    }
    
    .register-links a:hover {
        color: #2980b9;
        text-decoration: underline;
    }
    
    /* å•†å®¶ç±»å‹é€‰æ‹© */
    .business-types {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }
    
    .business-type {
        flex: 1;
        min-width: 120px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }
    
    .business-type:hover {
        border-color: #3498db;
        background-color: #f8f9fa;
    }
    
    .business-type.selected {
        border-color: #3498db;
        background-color: #e3f2fd;
    }
    
    .business-type-icon {
        font-size: 32px;
        margin-bottom: 10px;
    }
    
    .business-type-name {
        font-weight: 500;
        color: #34495e;
    }
    
    /* ç”¨æˆ·åè®® */
    .terms-agreement {
        margin-top: 20px;
        margin-bottom: 20px;
    }
    
    .terms-agreement label {
        display: flex;
        align-items: flex-start;
        font-size: 14px;
        color: #7f8c8d;
    }
    
    .terms-agreement input[type="checkbox"] {
        margin-right: 10px;
        margin-top: 2px;
    }
    
    .terms-agreement a {
        color: #3498db;
        text-decoration: none;
    }
    
    .terms-agreement a:hover {
        text-decoration: underline;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
        .merchant-register-container {
            padding: 30px 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .business-types {
            flex-direction: column;
        }
        
        .business-type {
            min-width: auto;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="merchant-register-container">
    <div class="merchant-register-header">
        <div class="merchant-logo">ğŸª</div>
        <h2 class="merchant-register-title">å•†æˆ·æ³¨å†Œ</h2>
        <p class="merchant-register-subtitle">åŠ å…¥æ—…æ¸¸å°åŠ©æ‰‹ï¼Œè®©æ›´å¤šæ¸¸å®¢å‘ç°æ‚¨çš„æœåŠ¡</p>
    </div>
    
    <form id="merchant-register-form">
        <!-- å•†å®¶ç±»å‹é€‰æ‹© -->
        <div class="form-group">
            <label>å•†å®¶ç±»å‹</label>
            <div class="business-types">
                <div class="business-type" data-type="hotel">
                    <div class="business-type-icon">ğŸ¨</div>
                    <div class="business-type-name">é…’åº—ä½å®¿</div>
                </div>
                <div class="business-type" data-type="attraction">
                    <div class="business-type-icon">ğŸ¯</div>
                    <div class="business-type-name">æ—…æ¸¸æ™¯åŒº</div>
                </div>
                <div class="business-type" data-type="restaurant">
                    <div class="business-type-icon">ğŸ½ï¸</div>
                    <div class="business-type-name">é¤é¥®ç¾é£Ÿ</div>
                </div>
                <div class="business-type" data-type="other">
                    <div class="business-type-icon">ğŸ”„</div>
                    <div class="business-type-name">å…¶ä»–æœåŠ¡</div>
                </div>
            </div>
            <input type="hidden" id="business-type-input" name="business_type" required>
        </div>
        
        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <div class="form-row">
            <div class="form-group">
                <label for="merchant-username">ç”¨æˆ·å</label>
                <input type="text" id="merchant-username" class="form-control" placeholder="è¯·è®¾ç½®ç™»å½•ç”¨æˆ·å" required>
            </div>
            <div class="form-group">
                <label for="merchant-phone">è”ç³»ç”µè¯</label>
                <input type="tel" id="merchant-phone" class="form-control" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯" required>
            </div>
        </div>
        
        <div class="form-group">
            <label for="merchant-email">ç”µå­é‚®ç®±</label>
            <input type="email" id="merchant-email" class="form-control" placeholder="è¯·è¾“å…¥ç”µå­é‚®ç®±" required>
        </div>
        
        <!-- å¯†ç è®¾ç½® -->
        <div class="form-group">
            <label for="merchant-password">å¯†ç </label>
            <input type="password" id="merchant-password" class="form-control" placeholder="è¯·è®¾ç½®å¯†ç " required>
            <div class="password-strength">
                <div class="password-strength-bar"></div>
            </div>
            <div class="password-strength-text">å¯†ç å¼ºåº¦ï¼šè¯·è¾“å…¥å¯†ç </div>
        </div>
        
        <div class="form-group">
            <label for="merchant-confirm-password">ç¡®è®¤å¯†ç </label>
            <input type="password" id="merchant-confirm-password" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
            <div id="password-match-message" class="form-text" style="display: none;"></div>
        </div>
        
        <!-- éªŒè¯ç  -->
        <div class="form-row">
            <div class="form-group">
                <label for="verification-code">éªŒè¯ç </label>
                <input type="text" id="verification-code" class="form-control" placeholder="è¯·è¾“å…¥éªŒè¯ç " required>
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
                <button type="button" class="btn btn-secondary" id="send-code-btn" style="width: 100%; padding: 12px;">
                    è·å–éªŒè¯ç 
                </button>
            </div>
        </div>
        
        <!-- ç”¨æˆ·åè®® -->
        <div class="terms-agreement">
            <label>
                <input type="checkbox" id="agree-terms" name="agree_terms" required>
                æˆ‘å·²é˜…è¯»å¹¶åŒæ„<a href="#" target="_blank">ã€Šå•†æˆ·æœåŠ¡åè®®ã€‹</a>å’Œ<a href="#" target="_blank">ã€Šéšç§æ”¿ç­–ã€‹</a>ï¼Œäº†è§£å¹¶æ¥å—æ‰€æœ‰æ¡æ¬¾å†…å®¹ã€‚
            </label>
        </div>
        
        <!-- æäº¤æŒ‰é’® -->
        <div class="form-group">
            <button type="submit" class="btn btn-primary" id="register-button">
                <span id="register-text">æ³¨å†Œ</span>
                <span id="register-loading" style="display: none;">æ³¨å†Œä¸­...</span>
            </button>
        </div>
    </form>
    
    <div class="register-links">
        <span>å·²æœ‰è´¦å·ï¼Ÿ</span>
        <a href="merchant_login.html">ç«‹å³ç™»å½•</a>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const registerForm = document.getElementById('merchant-register-form');
        const registerButton = document.getElementById('register-button');
        const registerText = document.getElementById('register-text');
        const registerLoading = document.getElementById('register-loading');
        const passwordInput = document.getElementById('merchant-password');
        const confirmPasswordInput = document.getElementById('merchant-confirm-password');
        const passwordStrength = document.querySelector('.password-strength');
        const passwordStrengthText = document.querySelector('.password-strength-text');
        const passwordMatchMessage = document.getElementById('password-match-message');
        const businessTypes = document.querySelectorAll('.business-type');
        const businessTypeInput = document.getElementById('business-type-input');
        const sendCodeBtn = document.getElementById('send-code-btn');
        
        // å•†å®¶ç±»å‹é€‰æ‹©
        businessTypes.forEach(type => {
            type.addEventListener('click', function() {
                // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
                businessTypes.forEach(t => t.classList.remove('selected'));
                // æ·»åŠ å½“å‰é€‰ä¸­çŠ¶æ€
                this.classList.add('selected');
                // è®¾ç½®éšè—å­—æ®µå€¼
                businessTypeInput.value = this.getAttribute('data-type');
            });
        });
        
        // å¯†ç å¼ºåº¦æ£€æµ‹
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            let strengthText = '';
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            // ç§»é™¤æ‰€æœ‰å¼ºåº¦ç±»
            passwordStrength.classList.remove('strength-weak', 'strength-medium', 'strength-strong');
            
            // è®¾ç½®å¼ºåº¦ç±»å’Œæ–‡æœ¬
            if (password.length === 0) {
                strengthText = 'å¯†ç å¼ºåº¦ï¼šè¯·è¾“å…¥å¯†ç ';
            } else if (strength <= 2) {
                passwordStrength.classList.add('strength-weak');
                strengthText = 'å¯†ç å¼ºåº¦ï¼šå¼±';
            } else if (strength === 3) {
                passwordStrength.classList.add('strength-medium');
                strengthText = 'å¯†ç å¼ºåº¦ï¼šä¸­';
            } else {
                passwordStrength.classList.add('strength-strong');
                strengthText = 'å¯†ç å¼ºåº¦ï¼šå¼º';
            }
            
            passwordStrengthText.textContent = strengthText;
            
            // æ£€æŸ¥å¯†ç æ˜¯å¦åŒ¹é…
            checkPasswordMatch();
        });
        
        // ç¡®è®¤å¯†ç åŒ¹é…æ£€æŸ¥
        confirmPasswordInput.addEventListener('input', function() {
            checkPasswordMatch();
        });
        
        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (confirmPassword.length > 0) {
                passwordMatchMessage.style.display = 'block';
                
                if (password === confirmPassword) {
                    passwordMatchMessage.textContent = 'å¯†ç åŒ¹é…';
                    passwordMatchMessage.style.color = '#27ae60';
                } else {
                    passwordMatchMessage.textContent = 'å¯†ç ä¸åŒ¹é…';
                    passwordMatchMessage.style.color = '#e74c3c';
                }
            } else {
                passwordMatchMessage.style.display = 'none';
            }
        }
        
        // å‘é€éªŒè¯ç 
        sendCodeBtn.addEventListener('click', function() {
            const email = document.getElementById('merchant-email').value;
            
            // éªŒè¯é‚®ç®±æ ¼å¼
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', 'error');
                return;
            }
            
            // ç¦ç”¨æŒ‰é’®å¹¶å¼€å§‹å€’è®¡æ—¶
            let countdown = 60;
            sendCodeBtn.disabled = true;
            sendCodeBtn.textContent = `${countdown}ç§’åé‡è¯•`;
            
            const timer = setInterval(() => {
                countdown--;
                sendCodeBtn.textContent = `${countdown}ç§’åé‡è¯•`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    sendCodeBtn.disabled = false;
                    sendCodeBtn.textContent = 'è·å–éªŒè¯ç ';
                }
            }, 1000);
            
            // æ¨¡æ‹Ÿå‘é€éªŒè¯ç è¯·æ±‚
            setTimeout(() => {
                showAlert('éªŒè¯ç å·²å‘é€è‡³æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶', 'success');
            }, 1000);
        });
        
        // è¡¨å•æäº¤å¤„ç†
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // è·å–è¡¨å•æ•°æ®
            const username = document.getElementById('merchant-username').value;
            const phone = document.getElementById('merchant-phone').value;
            const email = document.getElementById('merchant-email').value;
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const verificationCode = document.getElementById('verification-code').value;
            const agreeTerms = document.getElementById('agree-terms').checked;
            const businessType = businessTypeInput.value;
            
            // è¡¨å•éªŒè¯
            if (!businessType) {
                showAlert('è¯·é€‰æ‹©å•†å®¶ç±»å‹', 'error');
                return;
            }
            
            if (!username || username.length < 4) {
                showAlert('ç”¨æˆ·åè‡³å°‘éœ€è¦4ä¸ªå­—ç¬¦', 'error');
                return;
            }
            
            // ç®€å•çš„æ‰‹æœºå·éªŒè¯
            const phoneRegex = /^1[3-9]\d{9}$/;
            if (!phone || !phoneRegex.test(phone)) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ', 'error');
                return;
            }
            
            // é‚®ç®±æ ¼å¼éªŒè¯
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', 'error');
                return;
            }
            
            // å¯†ç éªŒè¯
            if (password.length < 8) {
                showAlert('å¯†ç é•¿åº¦è‡³å°‘éœ€è¦8ä¸ªå­—ç¬¦', 'error');
                return;
            }
            
            // å¯†ç åŒ¹é…éªŒè¯
            if (password !== confirmPassword) {
                showAlert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }
            
            // éªŒè¯ç éªŒè¯
            if (!verificationCode) {
                showAlert('è¯·è¾“å…¥éªŒè¯ç ', 'error');
                return;
            }
            
            // ç”¨æˆ·åè®®éªŒè¯
            if (!agreeTerms) {
                showAlert('è¯·é˜…è¯»å¹¶åŒæ„ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–', 'error');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            registerText.style.display = 'none';
            registerLoading.style.display = 'inline';
            registerButton.disabled = true;
            
            // æ¨¡æ‹Ÿæ³¨å†Œè¯·æ±‚
            setTimeout(() => {
                // è¿™é‡Œæ˜¯æ¨¡æ‹Ÿçš„æ³¨å†Œé€»è¾‘ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦è°ƒç”¨åç«¯API
                showAlert('æ³¨å†ŒæˆåŠŸï¼è¯·ç­‰å¾…å®¡æ ¸é€šè¿‡åå³å¯ç™»å½•', 'success');
                
                // é‡ç½®è¡¨å•å¹¶è·³è½¬
                setTimeout(() => {
                    window.location.href = 'merchant_login.html';
                }, 2000);
            }, 2000);
        });
        
        // å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
        function addPasswordToggle(inputId) {
            const passwordInput = document.getElementById(inputId);
            const togglePassword = document.createElement('button');
            togglePassword.type = 'button';
            togglePassword.className = 'toggle-password';
            togglePassword.style.position = 'absolute';
            togglePassword.style.right = '15px';
            togglePassword.style.top = '50%';
            togglePassword.style.transform = 'translateY(-50%)';
            togglePassword.style.background = 'none';
            togglePassword.style.border = 'none';
            togglePassword.style.cursor = 'pointer';
            togglePassword.innerHTML = '<i class="fas fa-eye"></i>';
            
            // è·å–å¯†ç è¾“å…¥æ¡†çš„çˆ¶å…ƒç´ 
            const passwordGroup = passwordInput.closest('.form-group');
            passwordGroup.style.position = 'relative';
            passwordGroup.appendChild(togglePassword);
            
            // åˆ‡æ¢å¯†ç å¯è§æ€§
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // åˆ‡æ¢å›¾æ ‡
                this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
        }
        
        // ä¸ºå¯†ç è¾“å…¥æ¡†æ·»åŠ æ˜¾ç¤º/éšè—åˆ‡æ¢åŠŸèƒ½
        addPasswordToggle('merchant-password');
        addPasswordToggle('merchant-confirm-password');
    });
</script>
{% endblock %}