{% extends "layout.html" %}

{% block title %}商户注册 - 旅游小助手{% endblock %}

{% block css %}
<style>
    /* 商户注册页面样式 */
    .merchant-register-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 40px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
        margin-bottom: 30px;
    }
    
    .merchant-register-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .merchant-register-title {
        font-size: 28px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .merchant-register-subtitle {
        color: #7f8c8d;
    }
    
    .merchant-logo {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        background-color: #3498db;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 40px;
    }
    
    /* 表单样式 */
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .form-group {
        flex: 1;
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #34495e;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 4px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3498db;
    }
    
    /* 密码强度指示器 */
    .password-strength {
        margin-top: 5px;
        height: 5px;
        border-radius: 3px;
        background-color: #eee;
        position: relative;
        overflow: hidden;
    }
    
    .password-strength-bar {
        height: 100%;
        width: 0;
        transition: width 0.3s ease, background-color 0.3s ease;
    }
    
    .strength-weak .password-strength-bar {
        width: 33%;
        background-color: #e74c3c;
    }
    
    .strength-medium .password-strength-bar {
        width: 66%;
        background-color: #f39c12;
    }
    
    .strength-strong .password-strength-bar {
        width: 100%;
        background-color: #27ae60;
    }
    
    .password-strength-text {
        font-size: 14px;
        margin-top: 5px;
        color: #7f8c8d;
    }
    
    /* 按钮样式 */
    .btn-primary {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 4px;
        background-color: #3498db;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .btn-primary:hover {
        background-color: #2980b9;
    }
    
    .btn-primary:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
    }
    
    /* 链接样式 */
    .register-links {
        margin-top: 20px;
        text-align: center;
    }
    
    .register-links a {
        color: #3498db;
        text-decoration: none;
        transition: color 0.3s ease;
    }
    
    .register-links a:hover {
        color: #2980b9;
        text-decoration: underline;
    }
    
    /* 商家类型选择 */
    .business-types {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }
    
    .business-type {
        flex: 1;
        min-width: 120px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }
    
    .business-type:hover {
        border-color: #3498db;
        background-color: #f8f9fa;
    }
    
    .business-type.selected {
        border-color: #3498db;
        background-color: #e3f2fd;
    }
    
    .business-type-icon {
        font-size: 32px;
        margin-bottom: 10px;
    }
    
    .business-type-name {
        font-weight: 500;
        color: #34495e;
    }
    
    /* 用户协议 */
    .terms-agreement {
        margin-top: 20px;
        margin-bottom: 20px;
    }
    
    .terms-agreement label {
        display: flex;
        align-items: flex-start;
        font-size: 14px;
        color: #7f8c8d;
    }
    
    .terms-agreement input[type="checkbox"] {
        margin-right: 10px;
        margin-top: 2px;
    }
    
    .terms-agreement a {
        color: #3498db;
        text-decoration: none;
    }
    
    .terms-agreement a:hover {
        text-decoration: underline;
    }
    
    /* 响应式调整 */
    @media (max-width: 768px) {
        .merchant-register-container {
            padding: 30px 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .business-types {
            flex-direction: column;
        }
        
        .business-type {
            min-width: auto;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="merchant-register-container">
    <div class="merchant-register-header">
        <div class="merchant-logo">🏪</div>
        <h2 class="merchant-register-title">商户注册</h2>
        <p class="merchant-register-subtitle">加入旅游小助手，让更多游客发现您的服务</p>
    </div>
    
    <form id="merchant-register-form">
        <!-- 商家类型选择 -->
        <div class="form-group">
            <label>商家类型</label>
            <div class="business-types">
                <div class="business-type" data-type="hotel">
                    <div class="business-type-icon">🏨</div>
                    <div class="business-type-name">酒店住宿</div>
                </div>
                <div class="business-type" data-type="attraction">
                    <div class="business-type-icon">🏯</div>
                    <div class="business-type-name">旅游景区</div>
                </div>
                <div class="business-type" data-type="restaurant">
                    <div class="business-type-icon">🍽️</div>
                    <div class="business-type-name">餐饮美食</div>
                </div>
                <div class="business-type" data-type="other">
                    <div class="business-type-icon">🔄</div>
                    <div class="business-type-name">其他服务</div>
                </div>
            </div>
            <input type="hidden" id="business-type-input" name="business_type" required>
        </div>
        
        <!-- 基本信息 -->
        <div class="form-row">
            <div class="form-group">
                <label for="merchant-username">用户名</label>
                <input type="text" id="merchant-username" class="form-control" placeholder="请设置登录用户名" required>
            </div>
            <div class="form-group">
                <label for="merchant-phone">联系电话</label>
                <input type="tel" id="merchant-phone" class="form-control" placeholder="请输入联系电话" required>
            </div>
        </div>
        
        <div class="form-group">
            <label for="merchant-email">电子邮箱</label>
            <input type="email" id="merchant-email" class="form-control" placeholder="请输入电子邮箱" required>
        </div>
        
        <!-- 密码设置 -->
        <div class="form-group">
            <label for="merchant-password">密码</label>
            <input type="password" id="merchant-password" class="form-control" placeholder="请设置密码" required>
            <div class="password-strength">
                <div class="password-strength-bar"></div>
            </div>
            <div class="password-strength-text">密码强度：请输入密码</div>
        </div>
        
        <div class="form-group">
            <label for="merchant-confirm-password">确认密码</label>
            <input type="password" id="merchant-confirm-password" class="form-control" placeholder="请再次输入密码" required>
            <div id="password-match-message" class="form-text" style="display: none;"></div>
        </div>
        
        <!-- 验证码 -->
        <div class="form-row">
            <div class="form-group">
                <label for="verification-code">验证码</label>
                <input type="text" id="verification-code" class="form-control" placeholder="请输入验证码" required>
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
                <button type="button" class="btn btn-secondary" id="send-code-btn" style="width: 100%; padding: 12px;">
                    获取验证码
                </button>
            </div>
        </div>
        
        <!-- 用户协议 -->
        <div class="terms-agreement">
            <label>
                <input type="checkbox" id="agree-terms" name="agree_terms" required>
                我已阅读并同意<a href="#" target="_blank">《商户服务协议》</a>和<a href="#" target="_blank">《隐私政策》</a>，了解并接受所有条款内容。
            </label>
        </div>
        
        <!-- 提交按钮 -->
        <div class="form-group">
            <button type="submit" class="btn btn-primary" id="register-button">
                <span id="register-text">注册</span>
                <span id="register-loading" style="display: none;">注册中...</span>
            </button>
        </div>
    </form>
    
    <div class="register-links">
        <span>已有账号？</span>
        <a href="merchant_login.html">立即登录</a>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const registerForm = document.getElementById('merchant-register-form');
        const registerButton = document.getElementById('register-button');
        const registerText = document.getElementById('register-text');
        const registerLoading = document.getElementById('register-loading');
        const passwordInput = document.getElementById('merchant-password');
        const confirmPasswordInput = document.getElementById('merchant-confirm-password');
        const passwordStrength = document.querySelector('.password-strength');
        const passwordStrengthText = document.querySelector('.password-strength-text');
        const passwordMatchMessage = document.getElementById('password-match-message');
        const businessTypes = document.querySelectorAll('.business-type');
        const businessTypeInput = document.getElementById('business-type-input');
        const sendCodeBtn = document.getElementById('send-code-btn');
        
        // 商家类型选择
        businessTypes.forEach(type => {
            type.addEventListener('click', function() {
                // 移除其他选中状态
                businessTypes.forEach(t => t.classList.remove('selected'));
                // 添加当前选中状态
                this.classList.add('selected');
                // 设置隐藏字段值
                businessTypeInput.value = this.getAttribute('data-type');
            });
        });
        
        // 密码强度检测
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            let strengthText = '';
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            // 移除所有强度类
            passwordStrength.classList.remove('strength-weak', 'strength-medium', 'strength-strong');
            
            // 设置强度类和文本
            if (password.length === 0) {
                strengthText = '密码强度：请输入密码';
            } else if (strength <= 2) {
                passwordStrength.classList.add('strength-weak');
                strengthText = '密码强度：弱';
            } else if (strength === 3) {
                passwordStrength.classList.add('strength-medium');
                strengthText = '密码强度：中';
            } else {
                passwordStrength.classList.add('strength-strong');
                strengthText = '密码强度：强';
            }
            
            passwordStrengthText.textContent = strengthText;
            
            // 检查密码是否匹配
            checkPasswordMatch();
        });
        
        // 确认密码匹配检查
        confirmPasswordInput.addEventListener('input', function() {
            checkPasswordMatch();
        });
        
        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (confirmPassword.length > 0) {
                passwordMatchMessage.style.display = 'block';
                
                if (password === confirmPassword) {
                    passwordMatchMessage.textContent = '密码匹配';
                    passwordMatchMessage.style.color = '#27ae60';
                } else {
                    passwordMatchMessage.textContent = '密码不匹配';
                    passwordMatchMessage.style.color = '#e74c3c';
                }
            } else {
                passwordMatchMessage.style.display = 'none';
            }
        }
        
        // 发送验证码
        sendCodeBtn.addEventListener('click', function() {
            const email = document.getElementById('merchant-email').value;
            
            // 验证邮箱格式
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                showAlert('请输入有效的邮箱地址', 'error');
                return;
            }
            
            // 禁用按钮并开始倒计时
            let countdown = 60;
            sendCodeBtn.disabled = true;
            sendCodeBtn.textContent = `${countdown}秒后重试`;
            
            const timer = setInterval(() => {
                countdown--;
                sendCodeBtn.textContent = `${countdown}秒后重试`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    sendCodeBtn.disabled = false;
                    sendCodeBtn.textContent = '获取验证码';
                }
            }, 1000);
            
            // 模拟发送验证码请求
            setTimeout(() => {
                showAlert('验证码已发送至您的邮箱，请查收', 'success');
            }, 1000);
        });
        
        // 表单提交处理
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 获取表单数据
            const username = document.getElementById('merchant-username').value;
            const phone = document.getElementById('merchant-phone').value;
            const email = document.getElementById('merchant-email').value;
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const verificationCode = document.getElementById('verification-code').value;
            const agreeTerms = document.getElementById('agree-terms').checked;
            const businessType = businessTypeInput.value;
            
            // 表单验证
            if (!businessType) {
                showAlert('请选择商家类型', 'error');
                return;
            }
            
            if (!username || username.length < 4) {
                showAlert('用户名至少需要4个字符', 'error');
                return;
            }
            
            // 简单的手机号验证
            const phoneRegex = /^1[3-9]\d{9}$/;
            if (!phone || !phoneRegex.test(phone)) {
                showAlert('请输入有效的手机号码', 'error');
                return;
            }
            
            // 邮箱格式验证
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                showAlert('请输入有效的邮箱地址', 'error');
                return;
            }
            
            // 密码验证
            if (password.length < 8) {
                showAlert('密码长度至少需要8个字符', 'error');
                return;
            }
            
            // 密码匹配验证
            if (password !== confirmPassword) {
                showAlert('两次输入的密码不一致', 'error');
                return;
            }
            
            // 验证码验证
            if (!verificationCode) {
                showAlert('请输入验证码', 'error');
                return;
            }
            
            // 用户协议验证
            if (!agreeTerms) {
                showAlert('请阅读并同意用户协议和隐私政策', 'error');
                return;
            }
            
            // 显示加载状态
            registerText.style.display = 'none';
            registerLoading.style.display = 'inline';
            registerButton.disabled = true;
            
            // 模拟注册请求
            setTimeout(() => {
                // 这里是模拟的注册逻辑，实际应用中需要调用后端API
                showAlert('注册成功！请等待审核通过后即可登录', 'success');
                
                // 重置表单并跳转
                setTimeout(() => {
                    window.location.href = 'merchant_login.html';
                }, 2000);
            }, 2000);
        });
        
        // 密码显示/隐藏切换
        function addPasswordToggle(inputId) {
            const passwordInput = document.getElementById(inputId);
            const togglePassword = document.createElement('button');
            togglePassword.type = 'button';
            togglePassword.className = 'toggle-password';
            togglePassword.style.position = 'absolute';
            togglePassword.style.right = '15px';
            togglePassword.style.top = '50%';
            togglePassword.style.transform = 'translateY(-50%)';
            togglePassword.style.background = 'none';
            togglePassword.style.border = 'none';
            togglePassword.style.cursor = 'pointer';
            togglePassword.innerHTML = '<i class="fas fa-eye"></i>';
            
            // 获取密码输入框的父元素
            const passwordGroup = passwordInput.closest('.form-group');
            passwordGroup.style.position = 'relative';
            passwordGroup.appendChild(togglePassword);
            
            // 切换密码可见性
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // 切换图标
                this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
        }
        
        // 为密码输入框添加显示/隐藏切换功能
        addPasswordToggle('merchant-password');
        addPasswordToggle('merchant-confirm-password');
    });
</script>
{% endblock %}