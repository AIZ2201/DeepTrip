{% extends "layout.html" %}

{% block title %}店铺信息上传 - 旅游小助手{% endblock %}

{% block css %}
<style>
    /* 店铺信息上传页面样式 */
    .shop-info-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 40px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
        margin-bottom: 30px;
    }
    
    .shop-info-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .shop-info-title {
        font-size: 28px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .shop-info-subtitle {
        color: #7f8c8d;
    }
    
    /* 表单样式 */
    .form-section {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .form-section:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    
    .form-section-title {
        font-size: 20px;
        font-weight: 600;
        color: #34495e;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #3498db;
    }
    
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .form-group {
        flex: 1;
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #34495e;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 4px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3498db;
    }
    
    /* 多行文本域 */
    textarea.form-control {
        resize: vertical;
        min-height: 100px;
    }
    
    /* 选择框样式 */
    select.form-control {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2334495e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 20px;
        padding-right: 45px;
    }
    
    /* 多选框样式 */
    .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 10px;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
    }
    
    .checkbox-item input[type="checkbox"] {
        margin-right: 8px;
    }
    
    /* 上传图片区域 */
    .image-upload-section {
        margin-bottom: 20px;
    }
    
    .image-upload-area {
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    
    .image-upload-area:hover {
        border-color: #3498db;
        background-color: #f8f9fa;
    }
    
    .image-upload-icon {
        font-size: 48px;
        color: #bdc3c7;
        margin-bottom: 10px;
    }
    
    .image-upload-text {
        color: #7f8c8d;
        font-size: 16px;
    }
    
    .image-upload-text strong {
        color: #3498db;
    }
    
    .image-upload-input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
        z-index: 10;
    }
    
    /* 预览图片容器 */
    .image-preview-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 20px;
    }
    
    .image-preview {
        position: relative;
        width: 150px;
        height: 150px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .image-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .image-preview-remove {
        position: absolute;
        top: 8px;
        right: 8px;
        background-color: rgba(231, 76, 60, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
    }
    
    .image-preview-remove:hover {
        background-color: #e74c3c;
    }
    
    /* 营业时间设置 */
    .business-hours-container {
        margin-top: 15px;
    }
    
    .business-hour-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .business-hour-day {
        width: 100px;
        font-weight: 500;
    }
    
    .business-hour-toggle {
        margin: 0 15px;
    }
    
    .business-hour-time {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    /* 服务项目设置 */
    .service-items-container {
        margin-top: 15px;
    }
    
    .service-item {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
    }
    
    .service-item input[type="text"],
    .service-item input[type="number"] {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
    }
    
    .remove-service-item {
        background-color: #e74c3c;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
    }
    
    .remove-service-item:hover {
        background-color: #c0392b;
    }
    
    .add-service-item {
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 10px 15px;
        cursor: pointer;
        margin-top: 10px;
    }
    
    .add-service-item:hover {
        background-color: #2980b9;
    }
    
    /* 按钮样式 */
    .btn-primary {
        padding: 12px 30px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 4px;
        background-color: #3498db;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .btn-primary:hover {
        background-color: #2980b9;
    }
    
    .btn-primary:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
    }
    
    .btn-secondary {
        padding: 12px 30px;
        font-size: 16px;
        font-weight: 600;
        border: 2px solid #3498db;
        border-radius: 4px;
        background-color: white;
        color: #3498db;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background-color: #3498db;
        color: white;
    }
    
    .form-actions {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 40px;
    }
    
    /* 响应式调整 */
    @media (max-width: 768px) {
        .shop-info-container {
            padding: 30px 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .form-actions {
            flex-direction: column;
        }
        
        .form-actions button {
            width: 100%;
        }
        
        .business-hour-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .business-hour-day {
            width: auto;
        }
        
        .business-hour-time {
            flex-wrap: wrap;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="shop-info-container">
    <div class="shop-info-header">
        <h2 class="shop-info-title">店铺信息上传</h2>
        <p class="shop-info-subtitle">完善您的店铺信息，吸引更多游客</p>
    </div>
    {% if filled and shop_info %}
    <div class="form-section">
        <h3 class="form-section-title">已上传店铺信息</h3>
        <ul>
            <li><strong>店铺名称：</strong>{{ shop_info.name }}</li>
            <li><strong>类别：</strong>{{ shop_info.category }}</li>
            <li><strong>价格区间：</strong>{{ shop_info.price_range }}</li>
            <li><strong>描述：</strong>{{ shop_info.description }}</li>
            <li><strong>地址：</strong>{{ shop_info.address }}</li>
            <li><strong>城市：</strong>{{ shop_info.city }}</li>
            <li><strong>区域：</strong>{{ shop_info.district }}</li>
            <li><strong>电话：</strong>{{ shop_info.phone }}</li>
            <li><strong>邮箱：</strong>{{ shop_info.email }}</li>
            <li><strong>网站：</strong>{{ shop_info.website }}</li>
            <li><strong>微信：</strong>{{ shop_info.wechat }}</li>
            <li><strong>节假日说明：</strong>{{ shop_info.holiday_info }}</li>
            <li><strong>营业时间：</strong>
                <ul>
                {% for bh in shop_info.business_hours %}
                    <li>{{ bh.day }}: {% if bh.isOpen %}{{ bh.startTime }}-{{ bh.endTime }}{% else %}休息{% endif %}</li>
                {% endfor %}
                </ul>
            </li>
            <li><strong>服务项目：</strong>
                <ul>
                {% for s in shop_info.service_items %}
                    <li>{{ s.name }} - {{ s.price }}元</li>
                {% endfor %}
                </ul>
            </li>
            <li><strong>店铺图片：</strong>
                <div style="display:flex;gap:10px;flex-wrap:wrap;">
                {% for img in shop_info.images %}
                    <img src="{{ img }}" style="width:100px;height:100px;border-radius:8px;object-fit:cover;">
                {% endfor %}
                </div>
            </li>
        </ul>
        <div style="color:#e74c3c;margin-top:20px;">如需修改请联系管理员</div>
    </div>
    {% else %}
    <!-- 基本信息 -->
    <div class="form-section">
        <h3 class="form-section-title">基本信息</h3>
        
        <div class="form-group">
            <label for="shop-name">店铺名称 <span style="color: red;">*</span></label>
            <input type="text" id="shop-name" class="form-control" placeholder="请输入店铺名称" required>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="shop-category">商家类别 <span style="color: red;">*</span></label>
                <select id="shop-category" class="form-control" required>
                    <option value="">请选择商家类别</option>
                    <option value="hotel">酒店住宿</option>
                    <option value="restaurant">餐饮美食</option>
                    <option value="attraction">旅游景区</option>
                    <option value="transportation">交通服务</option>
                    <option value="entertainment">娱乐休闲</option>
                    <option value="other">其他服务</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="shop-price-range">价格区间 <span style="color: red;">*</span></label>
                <select id="shop-price-range" class="form-control" required>
                    <option value="">请选择价格区间</option>
                    <option value="budget">经济型 (¥0-¥100)</option>
                    <option value="standard">标准型 (¥101-¥300)</option>
                    <option value="mid_range">中档型 (¥301-¥800)</option>
                    <option value="luxury">高档型 (¥801以上)</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label for="shop-description">店铺描述 <span style="color: red;">*</span></label>
            <textarea id="shop-description" class="form-control" placeholder="详细描述您的店铺特色、服务内容等" required></textarea>
        </div>
    </div>
    
    <!-- 位置信息 -->
    <div class="form-section">
        <h3 class="form-section-title">位置信息</h3>
        
        <div class="form-group">
            <label for="shop-address">详细地址 <span style="color: red;">*</span></label>
            <input type="text" id="shop-address" class="form-control" placeholder="请输入详细地址" required>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="shop-city">所在城市 <span style="color: red;">*</span></label>
                <input type="text" id="shop-city" class="form-control" placeholder="请输入所在城市" required>
            </div>
            
            <div class="form-group">
                <label for="shop-district">所在区域 <span style="color: red;">*</span></label>
                <input type="text" id="shop-district" class="form-control" placeholder="请输入所在区域" required>
            </div>
        </div>
        
        <div class="form-group">
            <label for="shop-map">地图位置</label>
            <div id="map-placeholder" style="width: 100%; height: 300px; background-color: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <p style="color: #7f8c8d;">地图加载中...</p>
            </div>
        </div>
    </div>
    
    <!-- 联系方式 -->
    <div class="form-section">
        <h3 class="form-section-title">联系方式</h3>
        
        <div class="form-row">
            <div class="form-group">
                <label for="shop-phone">联系电话 <span style="color: red;">*</span></label>
                <input type="tel" id="shop-phone" class="form-control" placeholder="请输入联系电话" required>
            </div>
            
            <div class="form-group">
                <label for="shop-email">电子邮箱</label>
                <input type="email" id="shop-email" class="form-control" placeholder="请输入电子邮箱">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="shop-website">官方网站</label>
                <input type="url" id="shop-website" class="form-control" placeholder="请输入官方网站地址">
            </div>
            
            <div class="form-group">
                <label for="shop-wechat">微信公众号</label>
                <input type="text" id="shop-wechat" class="form-control" placeholder="请输入微信公众号名称">
            </div>
        </div>
    </div>
    
    <!-- 营业时间 -->
    <div class="form-section">
        <h3 class="form-section-title">营业时间</h3>
        
        <div class="business-hours-container">
            {% for day in ['周一', '周二', '周三', '周四', '周五', '周六', '周日'] %}
            <div class="business-hour-item">
                <div class="business-hour-day">{{ day }}</div>
                <div class="business-hour-toggle">
                    <label class="switch">
                        <input type="checkbox" class="day-toggle" data-day="{{ loop.index }}" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="business-hour-time">
                    <input type="time" class="business-hour-start" data-day="{{ loop.index }}" value="09:00">
                    <span>-</span>
                    <input type="time" class="business-hour-end" data-day="{{ loop.index }}" value="18:00">
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="form-group">
            <label for="shop-holiday-info">节假日营业时间说明</label>
            <textarea id="shop-holiday-info" class="form-control" placeholder="请说明节假日是否有特殊营业时间安排"></textarea>
        </div>
    </div>
    
    <!-- 服务项目 -->
    <div class="form-section">
        <h3 class="form-section-title">服务项目</h3>
        
        <div id="service-items-container" class="service-items-container">
            <!-- 服务项目将通过JavaScript动态添加 -->
            <div class="service-item">
                <input type="text" placeholder="服务名称" class="service-name">
                <input type="number" placeholder="价格（元）" class="service-price" min="0" step="0.01">
                <button type="button" class="remove-service-item">删除</button>
            </div>
        </div>
        
        <button type="button" class="add-service-item" id="add-service-item-btn">添加服务项目</button>
    </div>
    
    <!-- 店铺图片 -->
    <div class="form-section">
        <h3 class="form-section-title">店铺图片</h3>
        
        <div class="image-upload-section">
            <div class="image-upload-area" id="image-upload-area">
                <i class="fas fa-cloud-upload-alt image-upload-icon"></i>
                <div class="image-upload-text">
                    点击或拖拽图片到此处上传<br>
                    <strong>支持jpg、png、gif格式，单张不超过5MB</strong>
                </div>
                <input type="file" id="image-upload-input" class="image-upload-input" accept="image/*" multiple>
            </div>
            
            <div id="image-preview-container" class="image-preview-container">
                <!-- 图片预览将通过JavaScript动态添加 -->
            </div>
        </div>
    </div>
    
    <!-- 提交按钮 -->
    <div class="form-actions">
        <button type="button" class="btn-secondary" id="save-draft-btn">保存草稿</button>
        <button type="submit" class="btn-primary" id="submit-btn">
            <span id="submit-text">提交审核</span>
            <span id="submit-loading" style="display: none;">提交中...</span>
        </button>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const shopInfoForm = document.getElementById('shop-info-form');
        const submitBtn = document.getElementById('submit-btn');
        const submitText = document.getElementById('submit-text');
        const submitLoading = document.getElementById('submit-loading');
        const imageUploadArea = document.getElementById('image-upload-area');
        const imageUploadInput = document.getElementById('image-upload-input');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const addServiceItemBtn = document.getElementById('add-service-item-btn');
        const serviceItemsContainer = document.getElementById('service-items-container');
        const dayToggles = document.querySelectorAll('.day-toggle');
        const businessHourStartInputs = document.querySelectorAll('.business-hour-start');
        const businessHourEndInputs = document.querySelectorAll('.business-hour-end');
        const saveDraftBtn = document.getElementById('save-draft-btn');
        
        // 加载地图占位符
        setTimeout(() => {
            const mapPlaceholder = document.getElementById('map-placeholder');
            mapPlaceholder.innerHTML = `
                <div style="text-align: center;">
                    <p style="color: #7f8c8d; margin-bottom: 15px;">请点击地图选择精确位置</p>
                    <button class="btn btn-primary" style="padding: 8px 20px; font-size: 14px;">选择位置</button>
                </div>
            `;
        }, 1000);
        
        // 添加服务项目
        addServiceItemBtn.addEventListener('click', function() {
            const newServiceItem = document.createElement('div');
            newServiceItem.className = 'service-item';
            newServiceItem.innerHTML = `
                <input type="text" placeholder="服务名称" class="service-name">
                <input type="number" placeholder="价格（元）" class="service-price" min="0" step="0.01">
                <button type="button" class="remove-service-item">删除</button>
            `;
            
            serviceItemsContainer.appendChild(newServiceItem);
            
            // 为新添加的删除按钮绑定事件
            const removeBtn = newServiceItem.querySelector('.remove-service-item');
            removeBtn.addEventListener('click', function() {
                newServiceItem.remove();
            });
        });
        
        // 为已有的删除按钮绑定事件
        document.querySelectorAll('.remove-service-item').forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.service-item').remove();
            });
        });
        
        // 营业时间切换
        dayToggles.forEach(toggle => {
            toggle.addEventListener('change', function() {
                const day = this.getAttribute('data-day');
                const startTimeInput = document.querySelector(`.business-hour-start[data-day="${day}"]`);
                const endTimeInput = document.querySelector(`.business-hour-end[data-day="${day}"]`);
                
                if (this.checked) {
                    startTimeInput.disabled = false;
                    endTimeInput.disabled = false;
                } else {
                    startTimeInput.disabled = true;
                    endTimeInput.disabled = true;
                }
            });
        });
        
        // 图片上传处理
        imageUploadArea.addEventListener('click', function() {
            imageUploadInput.click();
        });
        
        // 拖拽上传
        imageUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#3498db';
            this.style.backgroundColor = '#e3f2fd';
        });
        
        imageUploadArea.addEventListener('dragleave', function() {
            this.style.borderColor = '#bdc3c7';
            this.style.backgroundColor = 'transparent';
        });
        
        imageUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#bdc3c7';
            this.style.backgroundColor = 'transparent';
            
            if (e.dataTransfer.files.length) {
                handleFiles(e.dataTransfer.files);
            }
        });
        
        // 文件选择处理
        imageUploadInput.addEventListener('change', function() {
            if (this.files.length) {
                handleFiles(this.files);
            }
        });
        
        // 处理上传的文件
        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // 检查文件类型
                if (!file.type.match('image.*')) {
                    showAlert('请上传图片文件', 'error');
                    continue;
                }
                
                // 检查文件大小
                if (file.size > 5 * 1024 * 1024) { // 5MB
                    showAlert('图片大小不能超过5MB', 'error');
                    continue;
                }
                
                // 创建文件读取器
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // 创建图片预览
                    const preview = document.createElement('div');
                    preview.className = 'image-preview';
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="图片预览">
                        <button type="button" class="image-preview-remove">×</button>
                    `;
                    
                    // 添加删除按钮事件
                    const removeBtn = preview.querySelector('.image-preview-remove');
                    removeBtn.addEventListener('click', function() {
                        preview.remove();
                    });
                    
                    imagePreviewContainer.appendChild(preview);
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // 保存草稿
        saveDraftBtn.addEventListener('click', function() {
            // 收集表单数据
            const formData = collectFormData();
            
            // 显示保存成功提示
            showAlert('草稿保存成功', 'success');
        });

        // 表单提交处理
        shopInfoForm.addEventListener('submit', async function (e) {
            e.preventDefault();

            // 收集表单数据
            const formData = collectFormData();

            // 验证表单
            if (!validateForm(formData)) {
                return;
            }

            // 显示加载状态
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline';
            submitBtn.disabled = true;

            try {
                // 调用后端 API
                const response = await fetch('merchant/info/upload', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('店铺信息提交成功！请等待管理员审核', 'success');
                } else {
                    showAlert(result.message || '提交失败，请重试', 'error');
                }
            } catch (error) {
                showAlert('网络错误，请稍后再试', 'error');
            } finally {
                // 重置加载状态
                submitText.style.display = 'inline';
                submitLoading.style.display = 'none';
                submitBtn.disabled = false;
            }
        });


        // 收集表单数据
        function collectFormData() {
            // 收集基本信息
            const basicInfo = {
                name: document.getElementById('shop-name').value,
                category: document.getElementById('shop-category').value,
                priceRange: document.getElementById('shop-price-range').value,
                description: document.getElementById('shop-description').value
            };
            
            // 收集位置信息
            const locationInfo = {
                address: document.getElementById('shop-address').value,
                city: document.getElementById('shop-city').value,
                district: document.getElementById('shop-district').value
            };
            
            // 收集联系方式
            const contactInfo = {
                phone: document.getElementById('shop-phone').value,
                email: document.getElementById('shop-email').value,
                website: document.getElementById('shop-website').value,
                wechat: document.getElementById('shop-wechat').value
            };
            
            // 收集营业时间
            const businessHours = [];
            document.querySelectorAll('.business-hour-item').forEach((item, index) => {
                const day = index + 1;
                const isOpen = item.querySelector(`.day-toggle[data-day="${day}"]`).checked;
                const startTime = item.querySelector(`.business-hour-start[data-day="${day}"]`).value;
                const endTime = item.querySelector(`.business-hour-end[data-day="${day}"]`).value;
                
                businessHours.push({
                    day: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'][index],
                    isOpen,
                    startTime,
                    endTime
                });
            });
            
            // 收集服务项目
            const serviceItems = [];
            document.querySelectorAll('.service-item').forEach(item => {
                const name = item.querySelector('.service-name').value;
                const price = item.querySelector('.service-price').value;
                
                if (name && price) {
                    serviceItems.push({ name, price });
                }
            });
            
            // 收集节假日信息
            const holidayInfo = document.getElementById('shop-holiday-info').value;
            
            return {
                basicInfo,
                locationInfo,
                contactInfo,
                businessHours,
                serviceItems,
                holidayInfo
            };
        }
        
        // 验证表单
        function validateForm(formData) {
            // 验证基本信息
            if (!formData.basicInfo.name) {
                showAlert('请输入店铺名称', 'error');
                return false;
            }
            
            if (!formData.basicInfo.category) {
                showAlert('请选择商家类别', 'error');
                return false;
            }
            
            if (!formData.basicInfo.priceRange) {
                showAlert('请选择价格区间', 'error');
                return false;
            }
            
            if (!formData.basicInfo.description) {
                showAlert('请输入店铺描述', 'error');
                return false;
            }
            
            // 验证位置信息
            if (!formData.locationInfo.address) {
                showAlert('请输入详细地址', 'error');
                return false;
            }
            
            if (!formData.locationInfo.city) {
                showAlert('请输入所在城市', 'error');
                return false;
            }
            
            if (!formData.locationInfo.district) {
                showAlert('请输入所在区域', 'error');
                return false;
            }
            
            // 验证联系方式
            if (!formData.contactInfo.phone) {
                showAlert('请输入联系电话', 'error');
                return false;
            }
            
            // 验证是否有图片上传
            const hasImages = imagePreviewContainer.children.length > 0;
            if (!hasImages) {
                showAlert('请至少上传一张店铺图片', 'error');
                return false;
            }
            
            return true;
        }
    });
</script>
{% endblock %}